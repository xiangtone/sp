<?xml version="1.0" encoding="GBK"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="Company_Mo">
	<typeAlias alias="dto" type="org.eredlab.g4.ccl.datastructure.impl.BaseDto"/>
		<select id="queryMoByDay" parameterClass="map" resultClass="dto">
		 <![CDATA[
		               select a.id as id,
		                      a.company as company,
						       b.partnerName as companyName,
						       c.gamename as gameName,
						       a.cpn as cpn,
						       a.linkid as linkid,
						       a.addate as addate,
                               a.province as province,
						       e.provinces as provinceName,
						       a.postcode as postcode,
						       e.city as city,
						        a.tocompstat  as tocompstat,
						        a.comprecstat  as comprecstat,
						        f.memo
					  from smscompanymos.$tableName$ as a 
					  left join  smscompanymos.provscitys e on a.postcode=e.areaCode
					  left join   smscompanymos.partners as b on a.company=b.partner
					  left join smscompanymos.mostates AS f ON a.mostate = f.mostate
					  left join    smscompanymos.companygames c on a.game=c.gamecode
		             where 
		                   1=1
		                   ]]>
		             <isNotEmpty prepend="and" property="cpn">
				        a.cpn = #cpn#
				     </isNotEmpty>
				     <isNotEmpty prepend="and" property="gameName">
				        c.gameName like '%$gameName$%'
				       
				     </isNotEmpty>
				      <isNotEmpty prepend="and" property="companyName">
				        a.company like '$companyName$%' 
				     </isNotEmpty>
				     <isNotEmpty prepend="and" property="provinceName">
				        e.provinces like '%$provinceName$%'
				     </isNotEmpty>
				     <isNotEmpty prepend="and" property="city">
				         e.city like '%$city$%'
				     </isNotEmpty>
				      <isNotEmpty prepend="and" property="mttime1">
				         a.addate >= #mttime1#
				     </isNotEmpty>
				      <isNotEmpty prepend="and" property="mttime2">
				        <![CDATA[ a.addate <= #mttime2#]]>
				     </isNotEmpty>  
				     
				      <isNotEmpty prepend="and" property="tocompstat">
						     <isEqual  property="tocompstat" compareValue="1"> 
						            <![CDATA[ a.tocompstat = '1']]>
						     </isEqual>
						      <isEqual  property="tocompstat" compareValue="0"> 
						            <![CDATA[a.tocompstat != '1']]>
						     </isEqual>
				</isNotEmpty>  
				
				<isNotEmpty prepend="and" property="comprecstat">
						     <isEqual  property="comprecstat" compareValue="0"> 
						            <![CDATA[ a.comprecstat = '0']]>
						     </isEqual>
						      <isEqual  property="comprecstat" compareValue="1"> 
						            <![CDATA[a.comprecstat != '0']]>
						     </isEqual>
				</isNotEmpty>  
				<isNotEmpty prepend="and" property="mostate">
						     <isEqual  property="mostate" compareValue="0"> 
						            f.mostate=0
						     </isEqual>
						      <isEqual  property="mostate" compareValue="23"> 
						            f.mostate in(2,3)
						     </isEqual>
						      <isEqual  property="mostate" compareValue="4444"> 
						            f.mostate in(41,42,43,44)
						     </isEqual>
						     <isEqual  property="mostate" compareValue="1"> 
						            f.mostate=1
						     </isEqual>
						     <isEqual  property="mostate" compareValue="2"> 
						            f.mostate=2
						     </isEqual>
						     <isEqual  property="mostate" compareValue="3"> 
						            f.mostate=3
						     </isEqual>
						     <isEqual  property="mostate" compareValue="41"> 
						            f.mostate=41
						     </isEqual>
						     <isEqual  property="mostate" compareValue="42"> 
						            f.mostate=42
						     </isEqual>
						     <isEqual  property="mostate" compareValue="43"> 
						            f.mostate=43
						     </isEqual>
						     <isEqual  property="mostate" compareValue="44"> 
						            f.mostate=44
						     </isEqual>
						     <isEqual  property="mostate" compareValue="99"> 
						            f.mostate=99
						     </isEqual>
						     <isEqual  property="mostate" compareValue="5"> 
						            f.mostate=5
						     </isEqual>
				</isNotEmpty> 
				GROUP BY  a.linkid     
				 order by a.addate desc	    
				  
				      
		</select>
		
		
		
	<select id="queryMoByDayForCount" parameterClass="map" resultClass="java.lang.Integer">
		 <![CDATA[
		               select  count(DISTINCT a.linkid) as count
					        from smscompanymos.$tableName$ as a 
					  left join  smscompanymos.provscitys e on a.postcode=e.areaCode
					  left join   smscompanymos.partners as b on a.company=b.partner
					  left join smscompanymos.mostates AS f ON a.mostate = f.mostate
					  left join    smscompanymos.companygames c on a.game=c.gamecode
		             where 
		                   1=1
		                   ]]>
		             <isNotEmpty prepend="and" property="cpn">
				        a.cpn = #cpn#
				     </isNotEmpty>
				     <isNotEmpty prepend="and" property="gameName">
				        c.gameName like '%$gameName$%'
				       
				     </isNotEmpty>
				      <isNotEmpty prepend="and" property="companyName">
				         a.company like '$companyName$%' 
				     </isNotEmpty>
				     <isNotEmpty prepend="and" property="provinceName">
				       
				        e.provinces like '%$provinceName$%'
				     </isNotEmpty>
				     <isNotEmpty prepend="and" property="city">
				         e.city like '%$city$%'
				     </isNotEmpty>
				     <isNotEmpty prepend="and" property="mttime1">
				         a.addate >= #mttime1#
				     </isNotEmpty>
				      <isNotEmpty prepend="and" property="mttime2">
				        <![CDATA[ a.addate <= #mttime2#]]>
				     </isNotEmpty>    
				       <isNotEmpty prepend="and" property="tocompstat">
						     <isEqual  property="tocompstat" compareValue="1"> 
						            <![CDATA[ a.tocompstat = '1']]>
						     </isEqual>
						      <isEqual  property="tocompstat" compareValue="0"> 
						            <![CDATA[a.tocompstat != '1']]>
						     </isEqual>
				</isNotEmpty>  
				
				<isNotEmpty prepend="and" property="comprecstat">
						     <isEqual  property="comprecstat" compareValue="0"> 
						            <![CDATA[ a.comprecstat = '0']]>
						     </isEqual>
						      <isEqual  property="comprecstat" compareValue="1"> 
						            <![CDATA[a.comprecstat != '0']]>
						     </isEqual>
				</isNotEmpty> 
				<isNotEmpty prepend="and" property="mostate">
						     <isEqual  property="mostate" compareValue="0"> 
						            f.mostate=0
						     </isEqual>
						      <isEqual  property="mostate" compareValue="23"> 
						            f.mostate in(2,3)
						     </isEqual>
						      <isEqual  property="mostate" compareValue="4444"> 
						            f.mostate in(41,42,43,44)
						     </isEqual>
						     <isEqual  property="mostate" compareValue="1"> 
						            f.mostate=1
						     </isEqual>
						     <isEqual  property="mostate" compareValue="2"> 
						            f.mostate=2
						     </isEqual>
						     <isEqual  property="mostate" compareValue="3"> 
						            f.mostate=3
						     </isEqual>
						     <isEqual  property="mostate" compareValue="41"> 
						            f.mostate=41
						     </isEqual>
						     <isEqual  property="mostate" compareValue="42"> 
						            f.mostate=42
						     </isEqual>
						     <isEqual  property="mostate" compareValue="43"> 
						            f.mostate=43
						     </isEqual>
						     <isEqual  property="mostate" compareValue="44"> 
						            f.mostate=44
						     </isEqual>
						     <isEqual  property="mostate" compareValue="99"> 
						            f.mostate=99
						     </isEqual>
						     <isEqual  property="mostate" compareValue="5"> 
						            f.mostate=5
						     </isEqual>
				</isNotEmpty>   
	</select>
	
	<!-- 查询合作方名字  -->
	<select id="queryCompany" parameterClass="map" resultClass="dto">
		SELECT company as value,companyname as text 
		from smscompanymts.companys where companytag=1 order by company asc
	</select>
</sqlMap>
